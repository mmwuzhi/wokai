(this.webpackJsonpwokai=this.webpackJsonpwokai||[]).push([[0],{59:function(e,t,a){},95:function(e,t,a){"use strict";a.r(t);var n,s=a(0),c=a(43),r=a.n(c),o=a(12),i=a(4),l=(a(58),a(59),a(5)),u=a(3),j="USER_LOGIN_REQUEST",m="USER_LOGIN_SUCCESS",b="USER_LOGIN_FAIL",d="USER_LOGOUT_REQUEST",h="USER_LOGOUT_SUCCESS",O="USER_LOGOUT_FAIL",p="USER_CHECK_LOGGED_REQUEST",f="USER_CHECK_LOGGED_SUCCESS",v="USER_CHECK_LOGGED_FAIL",g="USER_SIGNUP_REQUEST",x="USER_SIGNUP_SUCCESS",N="USER_SIGNUP_FAIL",C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(u.a)(Object(u.a)({},e),{},{loading:!0});case m:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,logged:!0,userData:t.value});case b:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,error:t.value});case d:return Object(u.a)(Object(u.a)({},e),{},{loading:!0});case h:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,logged:!1,userData:{}});case O:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,error:t.value});case p:return Object(u.a)(Object(u.a)({},e),{},{loading:!0});case f:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,logged:!0,userData:t.value});case v:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,error:t.value});case g:return Object(u.a)(Object(u.a)({},e),{},{loading:!0});case x:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,logged:!0,userData:t.value});case N:return Object(u.a)(Object(u.a)({},e),{},{loading:!1,error:t.value});default:return e}},S=a(16),w=a.n(S),y=a(25),E=a(6),_=a.n(E),k=a(97),U=a(1),D=function(){return Object(U.jsx)("div",{className:"loading",children:Object(U.jsx)(k.a,{size:"large"})})},R=n=Object(s.createContext)(),P=R.Provider,I=(R.Consumer,{userData:{},error:null,logged:!1,loading:!0}),G=function(e){var t=Object(s.useReducer)(C,I),a=Object(l.a)(t,2),n=a[0],c=a[1];return Object(s.useEffect)((function(){!function(e){e({type:p}),_.a.get("/api/users/userInfo").then((function(t){0===t.data.code?e({type:f,value:t.data.data}):e({type:v})})).catch((function(t){console.log(t),e({type:v})}))}(c)}),[]),Object(U.jsxs)(P,{value:{state:n,dispatch:c},children:[n.loading&&Object(U.jsx)(D,{}),e.children]})},L=function(){var e=Object(s.useContext)(n).state;return Object(U.jsxs)("nav",{className:"navbar navbar-dark bg-info navbar-expand-lg shadow",children:[Object(U.jsxs)(o.b,{to:"/",className:"navbar-brand",children:["\u306a\u3093\u3067\u3082\u3055\u3044\u3068"," "]}),Object(U.jsx)("div",{className:"collpase navbar-collapse",children:Object(U.jsxs)("ul",{className:"navbar-nav mr-auto",children:[Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/",exact:!0,activeClassName:"active",className:"nav-link",children:"\u30db\u30fc\u30e0\u30da\u30fc\u30b8"})}),Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/comment",exact:!0,activeClassName:"active",className:"nav-link",children:"\u30b3\u30e1\u30f3\u30c8"})}),e.logged?Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/user/mypage",activeClassName:"active",className:"nav-link",children:"\u30de\u30a4\u30da\u30fc\u30b8"})}):Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/user/signup",activeClassName:"active",className:"nav-link",children:"\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7"})}),e.logged?Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/user/logout",activeClassName:"active",className:"nav-link",children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})}):Object(U.jsx)("li",{className:"navbar-item",children:Object(U.jsx)(o.c,{to:"/user/login",activeClassName:"active",className:"nav-link",children:"\u30ed\u30b0\u30a4\u30f3"})})]})})]})};function M(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),a=t[0],n=t[1];return Object(s.useEffect)((function(){document.title="You clicked ".concat(a," times")})),Object(U.jsxs)("div",{children:[Object(U.jsxs)("p",{children:["You clicked ",a," times"]}),Object(U.jsx)("button",{onClick:function(){return n(a+1)},children:"Click me"})]})}var T=function(e){var t=Object(s.useContext)(n).state,a=Object(s.useState)(""),c=Object(l.a)(a,2),r=c[0],o=c[1],i=Object(s.useState)(""),u=Object(l.a)(i,2),j=u[0],m=u[1],b=Object(s.useRef)(null),d=Object(s.useRef)(null);Object(s.useEffect)((function(){_.a.get("/api/users/userInfo").then((function(e){0===e.data.code?(o(e.data.data.username),b.current.focus()):d.current.focus()}))}),[]);return Object(U.jsxs)("div",{className:"comment-input",children:[Object(U.jsxs)("div",{className:"comment-field",children:[Object(U.jsx)("span",{className:"comment-field-name",children:"\u30e6\u30fc\u30b6\u540d\uff1a"}),Object(U.jsx)("div",{className:"comment-field-input",children:Object(U.jsx)("input",{value:r,ref:d,onChange:function(e){return o(e.target.value)}})})]}),Object(U.jsxs)("div",{className:"comment-field",children:[Object(U.jsx)("span",{className:"comment-field-name",children:"\u30b3\u30e1\u30f3\u30c8\uff1a"}),Object(U.jsx)("div",{className:"comment-field-input",children:Object(U.jsx)("textarea",{ref:b,value:j,onChange:function(e){return m(e.target.value)}})})]}),Object(U.jsx)("div",{className:"comment-field-button",children:Object(U.jsx)("button",{onClick:function(a){return function(a){if(a.preventDefault(),e.onSubmit){var n=t.userData.email;console.table(t.userData),console.log(n),e.onSubmit({username:r,email:n,content:j,createdTime:+new Date})}m("")}(a)},children:"\u6295\u7a3f"})})]})},F=function(e){var t=Object(s.useState)(""),a=Object(l.a)(t,2),n=a[0],c=a[1],r=Object(s.useRef)();Object(s.useEffect)((function(){return console.log(e.comment.email),i(),r.current=setInterval(i,6e4),function(){clearInterval(r.current)}}));var o,i=function(){var t=e.comment,a=(+Date.now()-t.createdTime)/1e3;c(a>60?a>3600?a>86400?function(e){var t=new Date(e);return"".concat(t.getFullYear(),"\u5e74").concat(t.getMonth()+1,"\u6708").concat(t.getDate(),"\u65e5 ").concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds())}(t.createdTime):"".concat(Math.round(a/3600)," \u6642\u9593\u524d"):"".concat(Math.round(a/60)," \u5206\u524d"):"".concat(Math.round(Math.max(a,1))," \u79d2\u524d"))};return Object(U.jsxs)("div",{className:"comment",children:[Object(U.jsxs)("div",{className:"comment-user",children:[Object(U.jsx)("span",{children:e.comment.username}),"\uff1a"]}),Object(U.jsx)("span",{className:"comment-createdtime",children:n}),Object(U.jsx)("p",{dangerouslySetInnerHTML:{__html:(o=e.comment.content,o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/`([\S\s]+?)`/g,"<code>$1</code>"))}}),!!e.comment.email&&Object(U.jsx)("span",{onClick:function(){e.onDeleteComment&&e.onDeleteComment(e.comment._id)},className:"comment-delete",children:"\u524a\u9664"})]})},H=function(e){return Object(U.jsx)("div",{children:e.comments.map((function(t,a){return Object(U.jsx)(F,{comment:t,index:a,onDeleteComment:function(t){return function(t){e.onDeleteComment&&e.onDeleteComment(t)}(t)}},a)}))})},A=function(){var e=Object(s.useState)([]),t=Object(l.a)(e,2),a=t[0],n=t[1];Object(s.useEffect)((function(){c()}),[]);var c=function(){_.a.get("/api/comments/").then((function(e){n(e.data)})).catch((function(e){console.error(e)}))};return Object(U.jsxs)("div",{className:"wrapper",children:[Object(U.jsx)(T,{onSubmit:function(e){return function(e){if(e)return e.username?e.content?void _.a.post("/api/comments/add",e).then(c).catch((function(e){console.log(e)})):alert("\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff01"):alert("\u30e6\u30fc\u30b6\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff01")}(e)}}),Object(U.jsx)(H,{comments:a,onDeleteComment:function(e){return function(e){_.a.delete("/api/comments/"+e).then((function(t){console.log(t.data),n(a.filter((function(t){return t._id!==e})))})).catch((function(e){console.log(e)}))}(e)}})]})},Q=function(e){var t=Object(s.useContext)(n),a=t.state,c=t.dispatch,r=Object(s.useState)(""),o=Object(l.a)(r,2),i=o[0],u=o[1],j=Object(s.useState)(""),m=Object(l.a)(j,2),b=m[0],d=m[1],h=Object(s.useState)(""),O=Object(l.a)(h,2),p=O[0],f=O[1],v=Object(s.useRef)(null),C=Object(s.useState)(""),S=Object(l.a)(C,2),E=S[0],k=S[1];Object(s.useEffect)((function(){!0===a.logged&&e.history.push("/user/mypage")}),[a.logged,e.history]);var D=function(e){if(p!==v.current.value)k({message:"\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u3066\u3044\u306a\u3044\uff01"});else{var t={username:i,email:b,password:p};k(""),function(e){return function(){var t=Object(y.a)(w.a.mark((function t(a){var n,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a({type:g}),t.next=4,_.a.post("/api/users/",e);case 4:n=t.sent,s=n.data,alert("\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\uff01"),a({type:x,value:s}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),a({type:N,value:t.t0.response?t.t0.response.data.message:"errorMessage"});case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}()}(t)(c)}};return Object(U.jsxs)("div",{children:[Object(U.jsx)("h3",{className:"mt-3 mb-5",children:"\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7"}),Object(U.jsxs)("form",{onSubmit:function(e){return D()},children:[Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0: "}),Object(U.jsx)("input",{type:"text",className:"form-control mt-2 mb-4",value:i,onChange:function(e){return u(e.target.value)}})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9: "}),Object(U.jsx)("input",{type:"email",className:"form-control mt-2 mb-4",value:b,onChange:function(e){return d(e.target.value)}})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30d1\u30b9\u30ef\u30fc\u30c9: "}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",value:p,onChange:function(e){return f(e.target.value)}})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u78ba\u8a8d: "}),Object(U.jsx)("span",{style:{color:"red"},children:E}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",ref:v})]}),Object(U.jsx)("div",{className:"form-group",children:Object(U.jsx)("input",{type:"submit",value:"\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7",className:"btn btn-info"})})]})]})},K=a(50),Y=a(51),J=a(22),q=a(53),z=a(52),B=function(e){Object(q.a)(a,e);var t=Object(z.a)(a);function a(e){var n;return Object(K.a)(this,a),(n=t.call(this,e)).onSubmit=n.onSubmit.bind(Object(J.a)(n)),n.state={username:"",email:"",password:"",newPassword:"",confirmNewPassword:"",errorMessage:"",message:""},_.a.get("/api/users/userInfo").then((function(e){0===e.data.code?n.setState({username:e.data.data.username,email:e.data.data.email}):n.props.history.push("/user/login")})),n}return Object(Y.a)(a,[{key:"onChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"onChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"onChangeNewPassword",value:function(e){this.setState({newPassword:e.target.value})}},{key:"onChangeNewConfirmPassword",value:function(e){this.setState({confirmNewPassword:e.target.value})}},{key:"onSubmit",value:function(e){var t=this;if(e.preventDefault(),this.state.newPassword!==this.state.confirmNewPassword)this.setState({message:"\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u3066\u3044\u306a\u3044\uff01"});else{var a={username:this.state.username,email:this.state.email,password:this.state.password,newPassword:this.state.newPassword};this.setState({message:""}),_.a.post("/api/users/update",a).then((function(){alert("\u5909\u66f4\u3057\u307e\u3057\u305f\uff01"),t.props.history.push("/comment")})).catch((function(e){t.setState({errorMessage:"\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u9593\u9055\u3044\u307e\u3057\u305f\uff01"}),alert(e)}))}}},{key:"render",value:function(){return Object(U.jsxs)("div",{children:[Object(U.jsx)("h3",{className:"mt-3 mb-5",children:"\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u5909\u66f4"}),Object(U.jsxs)("form",{onSubmit:this.onSubmit,children:[Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0: "}),Object(U.jsx)("input",{type:"text",className:"form-control mt-2 mb-4",value:this.state.username,onChange:this.onChangeUsername.bind(this)})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9: "}),Object(U.jsx)("span",{children:this.state.email})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30d1\u30b9\u30ef\u30fc\u30c9: "}),Object(U.jsx)("span",{style:{color:"red"},children:this.state.errorMessage}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",value:this.state.password,onChange:this.onChangePassword.bind(this)})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u65b0\u30d1\u30b9\u30ef\u30fc\u30c9: "}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",value:this.state.newPassword,onChange:this.onChangeNewPassword.bind(this)})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u65b0\u30d1\u30b9\u30ef\u30fc\u30c9\u78ba\u8a8d: "}),Object(U.jsx)("span",{style:{color:"red"},children:this.state.message}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",value:this.state.confirmNewPassword,onChange:this.onChangeNewConfirmPassword.bind(this)})]}),Object(U.jsx)("div",{className:"form-group",children:Object(U.jsx)("input",{type:"submit",value:"\u5909\u66f4",className:"btn btn-info"})})]})]})}}]),a}(s.Component),$=function(e){var t=Object(s.useContext)(n),a=t.state,c=t.dispatch,r=Object(s.useState)(""),o=Object(l.a)(r,2),i=o[0],u=o[1],d=Object(s.useState)(""),h=Object(l.a)(d,2),O=h[0],p=h[1];Object(s.useEffect)((function(){!0===a.logged&&e.history.push("/comment")}),[a.logged,e.history]);var f=function(e){e.preventDefault(),function(e,t){return function(){var a=Object(y.a)(w.a.mark((function a(n){var s,c,r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,n({type:j}),s={email:e,password:t},a.next=5,_.a.post("/api/users/login",s);case 5:c=a.sent,r=c.data,n({type:m,value:r}),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),n({type:b,value:a.t0.response?a.t0.response.data.message:"errorMessage"});case 13:case"end":return a.stop()}}),a,null,[[0,10]])})));return function(e){return a.apply(this,arguments)}}()}(i,O)(c)};return Object(U.jsxs)("div",{children:[Object(U.jsx)("h3",{className:"mt-3 mb-5",children:"\u30ed\u30b0\u30a4\u30f3"}),Object(U.jsxs)("form",{onSubmit:function(e){return f(e)},children:[Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9: "}),Object(U.jsx)("input",{type:"email",className:"form-control mt-2 mb-4",value:i,onChange:function(e){return u(e.target.value)}})]}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("label",{children:"\u30d1\u30b9\u30ef\u30fc\u30c9: "}),Object(U.jsx)("input",{type:"password",className:"form-control mt-2 mb-4",value:O,onChange:function(e){return p(e.target.value)}})]}),Object(U.jsx)("div",{className:"form-group",children:Object(U.jsx)("input",{type:"submit",value:"\u30b5\u30a4\u30f3\u30a4\u30f3",className:"btn btn-info"})})]})]})},V=function(e){var t=Object(s.useContext)(n),a=t.state,c=t.dispatch;Object(s.useEffect)((function(){!1===a.logged&&e.history.push("/user/login")}),[a.logged,e.history]);return Object(U.jsxs)("div",{children:[Object(U.jsx)("h3",{className:"mt-3 mb-5",children:"\u30ed\u30b0\u30a2\u30a6\u30c8"}),Object(U.jsx)("span",{className:"form-group",children:"\u306a\u3093\u3067\u3082\u3055\u3044\u3068\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u304b\uff1f"}),Object(U.jsxs)("div",{className:"form-group",children:[Object(U.jsx)("button",{onClick:function(){e.history.push("/")},className:"btn btn-info",style:{backgroundColor:"lightgray",borderColor:"lightgray"},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),Object(U.jsx)("button",{onClick:function(){return function(e){e({type:d}),_.a.get("/api/users/logout").then((function(){e({type:h})})).catch((function(t){e({type:O,value:t.response?t.response.data.message:"errorMessage"})}))}(c)},className:"btn btn-info",children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})]})]})};var W=function(){return Object(U.jsx)(o.a,{children:Object(U.jsxs)("div",{className:"container",children:[Object(U.jsx)(L,{}),Object(U.jsx)("br",{}),Object(U.jsx)(i.a,{path:"/",exact:!0,component:M}),Object(U.jsx)(i.a,{path:"/comment",component:A}),Object(U.jsx)(i.a,{path:"/user/signup",component:Q}),Object(U.jsx)(i.a,{path:"/user/mypage",component:B}),Object(U.jsx)(i.a,{path:"/user/login",component:$}),Object(U.jsx)(i.a,{path:"/user/logout",component:V})]})})};a(94);r.a.render(Object(U.jsx)(G,{children:Object(U.jsx)(W,{})}),document.getElementById("root"))}},[[95,1,2]]]);
//# sourceMappingURL=main.874cf6ad.chunk.js.map